sudo: required

language: python

python:
#  - 2.7
#  - 3.5
  - 3.6
#  - 3.7

#env:
#  - TOXENV=unit
#  - TOXENV=style

before_install:
  # NOTE: this is probably not required since you're not trying to pull or
  # push from a GitHub repo
  - git config --global user.email "OpenStack_TravisCI@f5.com"
  - git config --global user.name "Travis F5 Openstack"

install:
  - travis_retry sudo apt-get update
  - travis_retry sudo apt-get -y install libffi-dev libssl-dev
  - travis_retry pip install -r requirements.travis.txt

script:
  - tox

jobs:
  include:
    #- stage: test
    #  script: make sanity
    #  python: 3.6
    #  env: TOXENV=sanity
    #  if: branch = devel

    - stage: test
      script:
        - inv docs.module
        - make docker-test 
      python: 3.6
      env: TOXENV=docs-deploy
      if: branch = devel
    - stage: deploy
      if: branch = devel
      - provider: s3
        skip_cleanup: true
        access_key_id: $AWS_ACCESS_KEY_ID
        secret_access_key: $AWS_SECRET_ACCESS_KEY
        bucket: clouddocs.f5.com
        local_dir: docs/_build/html
        upload_dir: products/orchestration/ansible/devel
        on:
          repo: F5Networks/f5-ansible
        after_deploy:
          - aws cloudfront create-invalidation --distribution-id $AWS_DIST_ID --paths /products/orchestration/ansible/devel/  
